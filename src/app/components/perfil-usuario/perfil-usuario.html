<section class="perfil-usuario">
  <header class="perfil-usuario__header">
    <h1>Mi perfil</h1>
    @if (userInfo()) {
      <span class="perfil-usuario__badge">
        {{ rolActualTexto() }}
      </span>
    }
  </header>

  @if (isLoading()) {
    <p class="perfil-usuario__status">Cargando información del perfil...</p>
  } @else {
    @if (errorMessage()) {
      <p class="perfil-usuario__status perfil-usuario__status--error">
        {{ errorMessage() }}
      </p>
    }

    @let cliente = clienteDetalle();
    @let empleado = empleadoDetalle();
    @let info = userInfo();

    @if (esCliente() && cliente) {
      <article class="perfil-usuario__card">
        <header class="perfil-usuario__card-header">
          <h2>Datos personales</h2>
          @if (!editMode()) {
            <button type="button" class="perfil-usuario__edit" (click)="habilitarEdicion()">
              Editar perfil
            </button>
          }
        </header>

        @if (!editMode()) {
          <dl class="perfil-usuario__info">
            <div>
              <dt>Nombre</dt>
              <dd>{{ cliente.nombre }}</dd>
            </div>
            <div>
              <dt>Apellido</dt>
              <dd>{{ cliente.apellido }}</dd>
            </div>
            <div>
              <dt>DNI</dt>
              <dd>{{ cliente.dni }}</dd>
            </div>
            <div>
              <dt>Teléfono</dt>
              <dd>{{ cliente.telefono }}</dd>
            </div>
            <div>
              <dt>Email</dt>
              <dd>{{ cliente.email }}</dd>
            </div>
          </dl>
        } @else {
          <form [formGroup]="clienteForm" class="perfil-usuario__form">
            <div class="perfil-usuario__field">
              <label for="nombre">Nombre</label>
              <input id="nombre" type="text" formControlName="nombre" />
              @if (controls.nombre.invalid && controls.nombre.touched) {
                <span class="perfil-usuario__error">El nombre es obligatorio.</span>
              }
            </div>
            <div class="perfil-usuario__field">
              <label for="apellido">Apellido</label>
              <input id="apellido" type="text" formControlName="apellido" />
              @if (controls.apellido.invalid && controls.apellido.touched) {
                <span class="perfil-usuario__error">El apellido es obligatorio.</span>
              }
            </div>
            <div class="perfil-usuario__field">
              <label for="dni">DNI</label>
              <input id="dni" type="text" formControlName="dni" />
              @if (controls.dni.invalid && controls.dni.touched) {
                <span class="perfil-usuario__error">El DNI es obligatorio.</span>
              }
            </div>
            <div class="perfil-usuario__field">
              <label for="telefono">Teléfono</label>
              <input id="telefono" type="text" formControlName="telefono" />
              @if (controls.telefono.invalid && controls.telefono.touched) {
                <span class="perfil-usuario__error">El teléfono es obligatorio.</span>
              }
            </div>
            <div class="perfil-usuario__field">
              <label for="email">Email</label>
              <input id="email" type="email" formControlName="email" />
              @if (controls.email.invalid && controls.email.touched) {
                <span class="perfil-usuario__error">Ingresa un email válido.</span>
              }
            </div>
            <div class="perfil-usuario__field">
              <label for="contrasena">Contraseña</label>
              <input id="contrasena" type="text" formControlName="contrasena" />
              @if (controls.contrasena.invalid && controls.contrasena.touched) {
                <span class="perfil-usuario__error">La contraseña es obligatoria.</span>
              }
            </div>
          </form>

          @if (formError()) {
            <p class="perfil-usuario__status perfil-usuario__status--error">
              {{ formError() }}
            </p>
          }

          <footer class="perfil-usuario__actions">
            <button type="button" class="perfil-usuario__cancel" (click)="cancelarEdicion()" [disabled]="isSaving()">
              Cancelar
            </button>
            <button type="button" class="perfil-usuario__save" (click)="guardarCambios()" [disabled]="isSaving()">
              {{ isSaving() ? 'Guardando...' : 'Guardar cambios' }}
            </button>
          </footer>
        }
      </article>
    } @else if (empleado) {
      <article class="perfil-usuario__card">
        <header class="perfil-usuario__card-header">
          <h2>Datos del empleado</h2>
        </header>
        <dl class="perfil-usuario__info">
          <div>
            <dt>Nombre</dt>
            <dd>{{ empleado.nombre }}</dd>
          </div>
          <div>
            <dt>Apellido</dt>
            <dd>{{ empleado.apellido }}</dd>
          </div>
          <div>
            <dt>DNI</dt>
            <dd>{{ empleado.dni }}</dd>
          </div>
          <div>
            <dt>Teléfono</dt>
            <dd>{{ empleado.telefono }}</dd>
          </div>
          <div>
            <dt>Email</dt>
            <dd>{{ empleado.email }}</dd>
          </div>
          <div>
            <dt>Legajo</dt>
            <dd>{{ empleado.legajo || 'N/A' }}</dd>
          </div>
          <div>
            <dt>Rol</dt>
            <dd>{{ empleado.rol }}</dd>
          </div>
        </dl>
      </article>
    } @else if (info) {
      <article class="perfil-usuario__card">
        <header class="perfil-usuario__card-header">
          <h2>Información del usuario</h2>
        </header>
        <dl class="perfil-usuario__info">
          <div>
            <dt>Email</dt>
            <dd>{{ info.email }}</dd>
          </div>
          <div>
            <dt>Rol</dt>
            <dd>{{ rolActualTexto() }}</dd>
          </div>
        </dl>
      </article>
    } @else {
      <p class="perfil-usuario__status">No se encontró información del usuario.</p>
    }
  }
</section>
