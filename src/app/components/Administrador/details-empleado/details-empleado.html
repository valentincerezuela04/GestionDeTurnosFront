<section class="detalle-empleado">
  <header class="detalle-empleado__header">
    <h1>Detalle del empleado</h1>
    <button type="button" class="btn btn-soft btn-primary" (click)="volverAlListado()">Volver al listado</button>
  </header>

  @if (isLoading) {
    <p class="detalle-empleado__status">Cargando empleado...</p>
  }
  @if (errorMessage) {
    <p class="detalle-empleado__status detalle-empleado__status--error">
      {{ errorMessage }}
    </p>
  }

  @if (empleado && !isLoading) {
    <article class="detalle-empleado__card">
      <header>
        <h2>{{ empleado.nombre }} {{ empleado.apellido }}</h2>
        <span class="detalle-empleado__rol">{{ empleado.rol }}</span>
      </header>

      <div class="detalle-empleado__meta">
        <span>ID: {{ empleado.id }}</span>
      </div>

      @if (!editMode()) {
        <dl>
          <div>
            <dt>Legajo</dt>
            <dd>{{ empleado.legajo || 'N/A' }}</dd>
          </div>
          <div>
            <dt>DNI</dt>
            <dd>{{ empleado.dni }}</dd>
          </div>
          <div>
            <dt>Telefono</dt>
            <dd>{{ empleado.telefono }}</dd>
          </div>
          <div>
            <dt>Email</dt>
            <dd>{{ empleado.email }}</dd>
          </div>
        </dl>
      } @else {
        <form [formGroup]="empleadoForm" class="detalle-empleado__form">
          <div class="detalle-empleado__field">
            <label for="nombre">Nombre</label>
            <input id="nombre" type="text" formControlName="nombre" />
            @if (controls.nombre.invalid && controls.nombre.touched) {
              <span class="detalle-empleado__error">El nombre es obligatorio.</span>
            }
          </div>
          <div class="detalle-empleado__field">
            <label for="apellido">Apellido</label>
            <input id="apellido" type="text" formControlName="apellido" />
            @if (controls.apellido.invalid && controls.apellido.touched) {
              <span class="detalle-empleado__error">El apellido es obligatorio.</span>
            }
          </div>
          <div class="detalle-empleado__field">
            <label for="dni">DNI</label>
            <input id="dni" type="text" formControlName="dni" inputmode="numeric" maxlength="8" />
            @if (controls.dni.touched && controls.dni.hasError('required')) {
              <span class="detalle-empleado__error">El DNI es obligatorio.</span>
            }
            @if (controls.dni.touched && controls.dni.hasError('pattern')) {
              <span class="detalle-empleado__error">Solo numeros (7 u 8 digitos).</span>
            }
          </div>
          <div class="detalle-empleado__field">
            <label for="telefono">Telefono</label>
            <input id="telefono" type="text" formControlName="telefono" inputmode="tel" maxlength="10" />
            @if (controls.telefono.touched && controls.telefono.hasError('required')) {
              <span class="detalle-empleado__error">El telefono es obligatorio.</span>
            }
            @if (controls.telefono.touched && controls.telefono.hasError('pattern')) {
              <span class="detalle-empleado__error">Debe tener exactamente 10 numeros.</span>
            }
          </div>
          <div class="detalle-empleado__field">
            <label for="email">Email</label>
            <input id="email" type="email" formControlName="email" />
            @if (controls.email.invalid && controls.email.touched) {
              <span class="detalle-empleado__error">Ingresa un email valido.</span>
            }
          </div>
                    <div class="detalle-empleado__field">
            <label for="contrasena">Contrasena</label>
            <input
              id="contrasena"
              type="password"
              formControlName="contrasena"
              placeholder="Minimo 4 caracteres y un numero"
            />
            @if (controls.contrasena.touched && controls.contrasena.hasError('minlength')) {
              <span class="detalle-empleado__error">Debe tener al menos 4 caracteres.</span>
            }
            @if (controls.contrasena.touched && controls.contrasena.hasError('pattern')) {
              <span class="detalle-empleado__error">Incluye al menos un numero.</span>
            }
            <p class="detalle-empleado__status detalle-empleado__status--hint">
              Deja este campo vacio si no quieres cambiar la contrasena del empleado.
            </p>
          </div>

          <div class="detalle-empleado__field">
            <label for="confirmarContrasena">Confirmar contrasena</label>
            <input
              id="confirmarContrasena"
              type="password"
              formControlName="confirmarContrasena"
              placeholder="Repite la nueva contrasena"
            />
            @if (controls.confirmarContrasena.touched && controls.confirmarContrasena.hasError('minlength')) {
              <span class="detalle-empleado__error">Debe tener al menos 4 caracteres.</span>
            }
            @if (controls.confirmarContrasena.touched && controls.confirmarContrasena.hasError('pattern')) {
              <span class="detalle-empleado__error">Incluye al menos un numero.</span>
            }
            @if (controls.confirmarContrasena.touched && controls.confirmarContrasena.hasError('mismatch')) {
              <span class="detalle-empleado__error">Las contrasenas no coinciden.</span>
            }
          </div>


          <div class="detalle-empleado__field">
            <label for="legajo">Legajo</label>
            <input id="legajo" type="text" formControlName="legajo" />
          </div>
          <div class="detalle-empleado__field">
            <label>Rol</label>
            <input type="text" [value]="empleado.rol" disabled />
          </div>
        </form>
        @if (saveErrorMessage) {
          <p class="detalle-empleado__status detalle-empleado__status--error">
            {{ saveErrorMessage }}
          </p>
        }
      }

      <footer class="detalle-empleado__actions">
        @if (editMode()) {
          <button type="button" class="btn btn-soft" (click)="cancelarEdicion()" [disabled]="saveInProgress()">
            Cancelar
          </button>
          <button type="button" class="btn btn-soft btn-success" (click)="guardarCambios()" [disabled]="saveInProgress()">
            {{ saveInProgress() ? 'Guardando...' : 'Guardar cambios' }}
          </button>
        } @else {
          <button type="button" class="btn btn-soft btn-warning" (click)="habilitarEdicion()">
            Editar empleado
          </button>
        }
        <button type="button" class="btn btn-soft btn-error" (click)="eliminarEmpleado()" [disabled]="deleteInProgress">
          {{ deleteInProgress ? 'Eliminando...' : 'Eliminar empleado' }}
        </button>
      </footer>
    </article>
  }
</section>
