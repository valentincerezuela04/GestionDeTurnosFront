<div class="mis-reservas">
  <div class="mis-reservas-header">
    <h2>Historial general de reservas</h2>
  </div>

  <!-- Filtros -->
  <form class="historial-filtros" [formGroup]="filtrosForm">
    <div class="filtro-group">
      <label for="fechaDesde">Fecha desde</label>
      <input id="fechaDesde" type="date" formControlName="fechaDesde" />
    </div>

    <div class="filtro-group">
      <label for="fechaHasta">Fecha hasta</label>
      <input id="fechaHasta" type="date" formControlName="fechaHasta" />
    </div>

    <div class="filtro-group">
      <label for="estado">Estado</label>
      <select id="estado" formControlName="estado">
        <option *ngFor="let e of estadosDisponibles" [value]="e">
          {{ e === 'TODOS' ? 'Todos' : e }}
        </option>
      </select>
    </div>

    <div class="filtro-group">
      <label for="salaNumero">Sala</label>
      <select id="salaNumero" formControlName="salaNumero">
        <option value="TODAS">Todas</option>
        <option *ngFor="let sala of salasDisponibles" [value]="sala">
          Sala {{ sala }}
        </option>
      </select>
    </div>

    <div class="filtro-group">
      <label for="clienteEmail">Cliente (email)</label>
      <input
        id="clienteEmail"
        type="text"
        placeholder="Buscar por email"
        formControlName="clienteEmail"
      />
    </div>

    <div class="filtro-group">
      <label for="tipoPago">Tipo de pago</label>
      <select id="tipoPago" formControlName="tipoPago">
        <option value="TODOS">Todos</option>
        <option *ngFor="let t of tiposPagoDisponibles" [value]="t">
          {{ t }}
        </option>
      </select>
    </div>

    <div class="filtro-group">
      <label for="montoMin">Monto mínimo</label>
      <input id="montoMin" type="number" formControlName="montoMin" />
    </div>

    <div class="filtro-group">
      <label for="montoMax">Monto máximo</label>
      <input id="montoMax" type="number" formControlName="montoMax" />
    </div>

    <div class="filtro-group">
      <label for="ordenCampo">Ordenar por</label>
      <select id="ordenCampo" formControlName="ordenCampo">
        <option value="FECHA">Fecha</option>
        <option value="MONTO">Monto</option>
      </select>
    </div>

    <div class="filtro-group">
      <label for="ordenDireccion">Dirección</label>
      <select id="ordenDireccion" formControlName="ordenDireccion">
        <option value="DESC">Descendente</option>
        <option value="ASC">Ascendente</option>
      </select>
    </div>

    <button type="button" class="limpiar-btn" (click)="resetFiltros()">
      Limpiar filtros
    </button>
  </form>

  @if (loading) {
    <p class="no-reservas">Cargando historial...</p>
  } @else if (error) {
    <p class="no-reservas error">{{ error }}</p>
  } @else if (historialFiltrado && historialFiltrado.length > 0) {
    <div class="reservas-grid">
      @for (reserva of historialFiltrado; track reserva.id) {
        <app-card-reserva
          [reserva]="reserva"
          [mostrarCliente]="true"
          (reservaClick)="onReservaClick($event)"
        ></app-card-reserva>
      }
    </div>
  } @else {
    <p class="no-reservas">
      No hay reservas en el historial general.
    </p>
  }
</div>
