@if (reserva(); as reservaData) {
  <div class="details-container">
    <div class="details-header">
      <h2>Detalles de la Reserva #{{reservaData.id}}</h2>
      <button class="btn btn-secondary" (click)="volver()">Volver</button>
    </div>

    <div class="details-content">
      <div class="info-section">
        <h3>Información de la Sala</h3>
        @if (!isEditing()) {
          <div>
            <p><strong>Número de Sala:</strong> {{reservaData.salaNumero}}</p>
            <p><strong>Capacidad:</strong> {{reservaData.salaCapacidad}} personas</p>
          </div>
        } @else {
          <div class="edit-form">
            <div class="form-group">
              <label for="salaId">Sala:</label>
              <select
                id="salaId"
                [ngModel]="editForm().salaId"
                (ngModelChange)="updateSalaId($event)"
                class="form-control">
                <option [ngValue]="null" disabled>
                  Seleccioná una sala
                </option>
                @for (sala of salas(); track sala.id) {
                  <option [value]="sala.id">
                    Sala {{sala.numero}} - Capacidad {{sala.cantidad_personas}}
                  </option>
                }
              </select>
            </div>
          </div>
        }
      </div>

      <div class="info-section">
        <h3>Información de la Reserva</h3>
        @if (!isEditing()) {
          <div>
            <p><strong>Fecha de Inicio:</strong> {{reservaData.fechaInicio | date:'dd/MM/yyyy HH:mm'}}</p>
            <p><strong>Fecha de Fin:</strong> {{reservaData.fechaFinal | date:'dd/MM/yyyy HH:mm'}}</p>
            <p><strong>Tipo de Pago:</strong> {{reservaData.tipoPago}}</p>
            <p><strong>Estado:</strong> {{reservaData.estado}}</p>
            <p><strong>Cliente:</strong> {{reservaData.clienteEmail}}</p>
          </div>
        } @else {
          <div class="edit-form">
            <div class="form-group">
              <label for="fechaInicio">Fecha de Inicio:</label>
              <input 
                type="datetime-local" 
                id="fechaInicio" 
                [ngModel]="editForm().fechaInicio" 
                (ngModelChange)="updateFechaInicio($event)"
                class="form-control">
            </div>
            <div class="form-group">
              <label for="fechaFinal">Fecha de Fin:</label>
              <input 
                type="datetime-local" 
                id="fechaFinal" 
                [ngModel]="editForm().fechaFinal" 
                (ngModelChange)="updateFechaFinal($event)"
                class="form-control">
            </div>
            <div class="form-group">
              <label for="tipoPago">Tipo de Pago:</label>
              <select 
                id="tipoPago" 
                [ngModel]="editForm().tipoPago" 
                (ngModelChange)="updateTipoPago($event)"
                class="form-control">
                @for (tipo of tipoPagoOptions(); track tipo) {
                  <option [value]="tipo">{{tipo}}</option>
                }
              </select>
            </div>
          </div>
        }
      </div>

      <div class="actions-section">
        @if (!isEditing()) {
          <div>
            @if (puedeEditar()) {
              <button class="btn btn-primary" (click)="startEditing()">
                Editar
              </button>
            }
            <!-- Botón para CANCELAR (deja la reserva en estado CANCELADO y se ve en el historial) -->
            <button class="btn btn-warning" (click)="cancelarReserva()">
             Cancelar Reserva
            </button>
          </div>
        } @else {
          <div>
            <button class="btn btn-success" (click)="guardarCambios()">
              Guardar
            </button>
            <button class="btn btn-secondary" (click)="cancelEditing()">
              Cancelar Edición
            </button>
          </div>
        }
      </div>
    </div>
  </div>
} @else {
  <div class="loading">
    <p>Cargando detalles de la reserva...</p>
  </div>
}
