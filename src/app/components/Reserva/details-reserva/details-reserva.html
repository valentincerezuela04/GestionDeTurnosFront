@if (reserva(); as reservaData) {
  <div class="details-container">
    <div class="details-header">
      <div class="header-text">
        <p class="eyebrow">Reserva</p>
        <h2>Reserva #{{reservaData.id}}</h2>
        <div class="header-chips">
          <span class="estado-chip" [ngClass]="estadoClase(reservaData.estado)">
            {{ reservaData.estado }}
          </span>
          <span class="pago-chip">
            {{ formatTipoPago(reservaData.tipoPago) }}
          </span>
        </div>
      </div>
      <button class="btn btn-secondary" (click)="volver()">Volver</button>
    </div>

    <div class="details-content">
      <div class="info-section">
        <h3>Sala y cliente</h3>
        @if (!isEditing()) {
          <div class="detail-rows">
            <div class="detail-row">
              <span class="detail-label">Sala</span>
              <span class="detail-value">
                #{{reservaData.salaNumero}} - {{reservaData.salaCapacidad}} personas
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Cliente</span>
              <span class="detail-value">{{reservaData.clienteEmail}}</span>
            </div>
          </div>
        } @else {
          <div class="edit-form">
            <div class="form-group">
              <label for="salaId">Sala</label>
              <select
                id="salaId"
                [ngModel]="editForm().salaId"
                (ngModelChange)="updateSalaId($event)"
                class="form-control">
                <option [ngValue]="null" disabled>
                  Selecciona una sala
                </option>
                @for (sala of salas(); track sala.id) {
                  <option [value]="sala.id">
                    Sala {{sala.numero}} - Capacidad {{sala.cantidad_personas}}
                  </option>
                }
              </select>
            </div>
            <div class="form-group form-group--readonly">
              <label>Cliente</label>
              <div class="readonly-value">{{reservaData.clienteEmail}}</div>
            </div>
          </div>
        }
      </div>

      <div class="info-section">
        <h3>Pago y estado</h3>
        @if (!isEditing()) {
          <div class="detail-rows">
            <div class="detail-row">
              <span class="detail-label">Monto</span>
              <span class="detail-value detail-value--strong">
                {{reservaData.monto | currency:'ARS':'symbol':'1.0-0'}}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Tipo de pago</span>
              <span class="detail-value">{{formatTipoPago(reservaData.tipoPago)}}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Estado</span>
              <span class="detail-value">
                <span class="estado-chip" [ngClass]="estadoClase(reservaData.estado)">
                  {{reservaData.estado}}
                </span>
              </span>
            </div>
          </div>
        } @else {
          <div class="edit-form">
            <div class="form-group">
              <label for="tipoPago">Tipo de Pago</label>
              <select
                id="tipoPago"
                [ngModel]="editForm().tipoPago"
                (ngModelChange)="updateTipoPago($event)"
                class="form-control">
                @for (tipo of tipoPagoOptions(); track tipo) {
                  <option [value]="tipo">{{tipo}}</option>
                }
              </select>
            </div>
            <div class="form-group form-group--readonly">
              <label>Monto</label>
              <div class="readonly-value">
                {{reservaData.monto | currency:'ARS':'symbol':'1.0-0'}}
              </div>
            </div>
            <div class="form-group form-group--readonly">
              <label>Estado</label>
              <div class="readonly-value readonly-value--chip">
                <span class="estado-chip" [ngClass]="estadoClase(reservaData.estado)">
                  {{reservaData.estado}}
                </span>
              </div>
            </div>
          </div>
        }
      </div>

      <div class="info-section">
        <h3>Agenda</h3>
        @if (!isEditing()) {
          <div class="detail-rows">
            <div class="detail-row">
              <span class="detail-label">Fecha de inicio</span>
              <span class="detail-value">
                {{reservaData.fechaInicio | date:'dd/MM/yyyy HH:mm'}}
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Fecha de fin</span>
              <span class="detail-value">
                {{reservaData.fechaFinal | date:'dd/MM/yyyy HH:mm'}}
              </span>
            </div>
          </div>
        } @else {
          <div class="edit-form edit-form--two-cols">
            <div class="form-group">
              <label for="fechaInicio">Fecha de Inicio</label>
              <input
                type="datetime-local"
                id="fechaInicio"
                [ngModel]="editForm().fechaInicio"
                (ngModelChange)="updateFechaInicio($event)"
                class="form-control">
            </div>
            <div class="form-group">
              <label for="fechaFinal">Fecha de Fin</label>
              <input
                type="datetime-local"
                id="fechaFinal"
                [ngModel]="editForm().fechaFinal"
                (ngModelChange)="updateFechaFinal($event)"
                class="form-control">
            </div>
          </div>
        }
      </div>

      @if (accionesHabilitadas()) {
        <div class="actions-section">
          @if (!isEditing()) {
            <div>
              @if (puedeEditar()) {
                <button class="btn btn-primary" (click)="startEditing()">
                  Editar
                </button>
              }
              <button class="btn btn-warning" (click)="cancelarReserva()">
               Cancelar Reserva
              </button>
            </div>
          } @else {
            <div>
              <button class="btn btn-success" (click)="guardarCambios()">
                Guardar
              </button>
              <button class="btn btn-secondary" (click)="cancelEditing()">
                Cancelar Edici√≥n
              </button>
            </div>
          }
        </div>
      }
    </div>
  </div>
} @else {
  <div class="loading">
    <p>Cargando detalles de la reserva...</p>
  </div>
}
